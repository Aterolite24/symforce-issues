{%- import "../util/util.jinja" as util with context -%}

//  -----------------------------------------------------------------------------
// This file was autogenerated by symforce. Do NOT modify by hand.
// -----------------------------------------------------------------------------
#pragma once

#include <Eigen/Dense>

namespace cam {

/**
{% for line in doc.cls.split('\n') %}
 *{{ ' {}'.format(line).rstrip() }}
{% endfor %}
 */
template <typename CameraCalType>
class Camera {
 public:
  using Scalar = typename CameraCalType::Scalar;

  Camera(const CameraCalType& calibration, const Eigen::Vector2i& image_size=Eigen::Vector2i(-1, -1))
    : calibration_(calibration),
      image_size_(image_size) {
  }
  {{ util.print_docstring(doc.pixel_coords_from_camera_point) | indent(2) }}
  Eigen::Matrix<Scalar, 2, 1> PixelCoordsFromCameraPoint(const Eigen::Matrix<Scalar, 3, 1>& point, const Scalar epsilon, Scalar* const is_valid) const {
    const Eigen::Matrix<Scalar, 2, 1> pixel_coords = calibration_.PixelCoordsFromCameraPoint(point, epsilon, is_valid);
    if (is_valid != nullptr) {
      *is_valid *= MaybeCheckInView(pixel_coords);
    }
    return pixel_coords;
  }
  {{ util.print_docstring(doc.camera_ray_from_pixel_coords) | indent(2) }}
  Eigen::Matrix<Scalar, 3, 1> CameraRayFromPixelCoords(const Eigen::Matrix<Scalar, 2, 1>& pixel_coords, const Scalar epsilon, Scalar* const is_valid) const {
    const Eigen::Matrix<Scalar, 3, 1> camera_ray = calibration_.CameraRayFromPixelCoords(pixel_coords, epsilon, is_valid);
    if (is_valid != nullptr) {
      *is_valid *= MaybeCheckInView(pixel_coords);
    }
    return camera_ray;
  }
  {{ util.print_docstring(doc.maybe_check_in_view) | indent(2) }}
  Scalar MaybeCheckInView(const Eigen::Matrix<Scalar, 2, 1>& pixel_coords) const {
    if(image_size_[0] <= 0 || image_size_[1] <= 0) {
      // image size is not defined, don't check if the pixel is in view
      return 1;
    }
    return InView(pixel_coords, image_size_);
  }
  {{ util.print_docstring(doc.in_view) | indent(2) }}
  static Scalar InView(const Eigen::Matrix<Scalar, 2, 1>& pixel_coords, const Eigen::Matrix<int, 2, 1>& image_size) {
    const bool x_in_view = (pixel_coords[0] >= 0) && (pixel_coords[0] <= image_size[0] - 1);
    const bool y_in_view = (pixel_coords[1] >= 0) && (pixel_coords[1] <= image_size[1] - 1);
    return (x_in_view && y_in_view) ? 1 : 0;
  }

  CameraCalType Calibration() const {
    return calibration_;
  }

  Eigen::Matrix<int, 2, 1> ImageSize() const {
    return image_size_;
  }

  private:
    CameraCalType calibration_;
    Eigen::Matrix<int, 2, 1> image_size_;
};

}  // namespace cam
